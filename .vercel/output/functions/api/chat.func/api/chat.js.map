{"version":3,"names":["handler","req","res","method","status","json","error","setHeader","end","messages","temperature","top_p","max_tokens","body","Array","isArray","API_KEY","process","env","ZHIPU_API_KEY","console","apiKeyId","apiKeySecret","split","header","alg","sign_type","now","Date","timestamp","Math","floor","payload","api_key","exp","base64UrlEncode","str","utf8Bytes","encodeURIComponent","replace","match","p1","String","fromCharCode","base64","btoa","encodedHeader","JSON","stringify","encodedPayload","dataToSign","encoder","TextEncoder","keyData","encode","messageData","cryptoKey","crypto","subtle","importKey","name","hash","signature","sign","encodedSignature","Uint8Array","token","response","fetch","headers","model","ok","errorData","details","data","message"],"sources":["chat.js"],"mappings":"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","ignoreList":[]}